<html>
  <body>
    <textarea rows="24" cols="80" id="ta"></textarea><br />
    <span style="font-family: monospace">user=&gt;</span>
    <textarea id="text" rows="6" cols="80"
      style="vertical-align: top"></textarea>
    <div id="status"></div>
    <!--
    <form onsubmit="jsrepl.runtest(); return false">
      <select id="t">
        <option>t01.js</option>
        <option>t02.js</option>
        <option>t03.js</option>
        <option>t04.js</option>
        <option>t05.js</option>
        <option>t06.js</option>
      </select>
      <input type="submit" value="Run test" />
    </form>
    -->
    <script type="text/javascript">
      jsrepl = {
        ta: document.getElementById( 'ta' ),
        t: document.getElementById( 't' ),
        text: document.getElementById( 'text' ),
        status: document.getElementById( 'status' ),
        runtest: function() {
          var s = document.createElement('script');
          s.src = jsrepl.t.value;
          document.body.appendChild( s );
        },
        posttext: function() {
          var text = jsrepl.text.value.replace(/\n$/,"");
          print( "user=> " + text.replace(/\n/g,"\n       "));
          jsrepl.text.value = "";
        },
        state: function(s,m) {
          jsrepl.status.innerHTML = s;
          switch( s ) {
            case 'error':
              jsrepl.posttext();
              print( m );
              break;
            case 'compiled':
              jsrepl.posttext();
              break;
          }
          jsrepl.ta.scrollTop = jsrepl.ta.scrollHeight;
        }
      };
      jsrepl.text.onkeypress = function(e) {
        e = e || event;
        if( e.keyCode == 13 ) {
          var s = document.createElement('script');
          s.src = "http://localhost:8081/" +
            escape(jsrepl.text.value).replace(/\+/,'%2b');
          document.body.appendChild( s );
        }
      };
      function print( x ) { jsrepl.ta.value += x + "\n"; }
    </script>
    <script type="text/javascript" src="clj.js"></script>
    <script type="text/javascript" src="boot.js"></script>
  </body>
</html>
